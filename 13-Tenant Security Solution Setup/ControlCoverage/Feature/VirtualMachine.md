## Virtual Machine

| ControlId and Description | Used API(s) and Properties | Logic |
|---------------------------|----------------------------|-------|
| Azure_VirtualMachine_SI_Enable_Vuln_Solution<br><br><b>Description:</b><br>Vulnerability assessment solution should be installed on VM | <b>ARM API to list Virtual Machine Extensions at subscription level:</b><br>/subscriptions/{subscriptionId}/resourceGroups/<br>{resourceGroupName}/providers/Microsoft.Compute<br>/virtualMachines/{vmName}/extensions?api-version=2019-07-01<br><br><b>Properties:</b><br>publisher, type<br>| <b>Passed: </b><br>Required vulnerability assessment solution is present in VM.<br><b>Failed: </b><br>Required vulnerability assessment solution is not present in VM.<br><b>NotApplicable: </b><br>VM instance is part of AKS or ADB cluster.<br><b>Not Scanned: </b><br>VM OS type is null or empty. |
| Azure_VirtualMachine_SI_Enable_Monitoring_Agent<br><br><b>Description:</b><br>All VMs must have Monitoring Agent enabled | <b>ARM API to list Virtual Machine Extensions at subscription level:</b><br>/subscriptions/{subscriptionId}/resourceGroups/<br>{resourceGroupName}/providers/Microsoft.Compute<br>/virtualMachines/{vmName}/extensions?api-version=2019-07-01<br><br><b>Properties:</b><br>publisher, type| <b>Passed: </b><br>All required extensions are present in VM<br><b>Failed: </b><br>One or more required extensions are missing in VM.<br><b>NotApplicable: </b><br>VM is part of ADB cluster.<br><b>Not Scanned: </b><br>VM OS type is null or empty. |
| Azure_VirtualMachine_NetSec_Dont_Open_Restricted_Ports<br><br><b>Description:</b><br>Do not leave restricted ports open on Virtual Machines | <b>ARM API to list JIT network access policies at subscription level:</b><br>/subscriptions/{subscriptionId}/providers/Microsoft.<br>Security/jitNetworkAccessPolicies?api-version=2020-01-01<br><b>Property:</b><br>virtualMachines/ports<br><br><b>ARM API to list Network Security Groups at subscription level:</b><br>/subscriptions/{subscriptionId}/providers/Microsoft.<br>Network/networkSecurityGroups?api-version=2019-04-01"<br><b>Property:</b><br>destinationPortRange<br><br><b>ARM API to list Virtual Networks at subscription level:</b><br>/subscriptions/{subscriptionId}/providers/Microsoft.<br>Network/virtualNetworks?api-version=2019-11-01<br><b>Property:</b><br>networkSecurityGroup/id| <b>Passed: </b><br>NSG is configured and no inbound port is open or NSG is configured and no restricted ports are open<br><b>Failed: </b><br>No NSG is configured on VM or NSG is configured but restricted ports are open.<br><b>NotApplicable: </b><br>VM instance is part of ADB cluster.|
| Azure_VirtualMachine_NetSec_Apply_ASC_Network_Recommendations<br><br><b>Description:</b><br>Adaptive Network Hardening recommendations should be applied on internet facing virtual machines | <b>ARM API to list security assessments at subscription level:</b><br>/subscriptions/{subscriptionId}/providers/Microsoft.Security<br>/assessments?api-version=2020-01-01<br><br><b>Properties:</b><br>id, name, resourceDetails/Id, displayName, status/code, status, additionalData | <b>Passed: </b><br>ASC assessment found with Healthy status code.<br><b>Failed: </b><br>ASC assessment found with Unhealthy status code.|
